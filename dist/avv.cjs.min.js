"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var isArray=Array.isArray,keyList=Object.keys,hasProp=Object.prototype.hasOwnProperty;function equal(t,e){if(t===e)return!0;if(t&&e&&"object"==typeof t&&"object"==typeof e){var i,n,r,a=isArray(t),s=isArray(e);if(a&&s){if((n=t.length)!=e.length)return!1;for(i=n;0!=i--;)if(!equal(t[i],e[i]))return!1;return!0}if(a!=s)return!1;var o=t instanceof Date,l=e instanceof Date;if(o!=l)return!1;if(o&&l)return t.getTime()==e.getTime();var u=t instanceof RegExp,h=e instanceof RegExp;if(u!=h)return!1;if(u&&h)return t.toString()==e.toString();var d=keyList(t);if((n=d.length)!==keyList(e).length)return!1;for(i=n;0!=i--;)if(!hasProp.call(e,d[i]))return!1;for(i=n;0!=i--;)if(!equal(t[r=d[i]],e[r]))return!1;return!0}return t!=t&&e!=e}function debounce(t,e,i){var n;return function(){var r=this,a=arguments,s=i&&!n;clearTimeout(n),n=setTimeout(function(){n=null,i||t.apply(r,a)},e),s&&t.apply(r,a)}}function formatMessage(t,e){var i=Array.prototype.slice.call(arguments,2),n=e.prop?e.prop:"field";return n=prettyLabel(n.trim()),i.unshift(t,n),format.apply(this,i)}function format(t){var e=Array.prototype.slice.call(arguments,1);return t.replace(/{(\d+)}/g,function(t,i){return void 0!==e[i]?e[i]:t})}function isArray$1(t){return Array.isArray(t)}function isEmpty(t){return isArray$1(t)?!t.length:null==t||!String(t).trim().length}function isEqual(t,e){return equal(t,e)}function isFunction(t){return"function"==typeof t}function isNaN(t){return/^\s*$/.test(t)||window.isNaN(t)}function isNull(t){return null===t}function isString(t){return"string"==typeof t||t instanceof String}function isUndefined(t){return void 0===t}function omit(t,e){var i={};for(var n in t)n!==e&&(i[n]=t[n]);return i}function fromEntries(t){var e={};return t.forEach(function(t){e[t]=null}),e}function splitKeypath(t){var e=t.split(".");return{path:t,parts:e,prop:e[e.length-1]}}function prettyLabel(t){return t=capitalize(t=(t=t.replace(/([A-Z])/g," $1")).toLowerCase())}function capitalize(t){return"string"!=typeof t?"":t.charAt(0).toUpperCase()+t.slice(1)}function optionCombiner(t){return t.length>2&&(t=[t.slice(0,t.length-1).join(", "),t[t.length-1]]),t.join(" or ")}var Flags=function(){this.reset()};Flags.prototype.reset=function(){this.touched=!1,this.untouched=!0,this.dirty=!1,this.pristine=!0,this.valid=!0,this.invalid=!1,this.pending=!1,this.validated=!1,this.changed=!1},Flags.prototype.setValid=function(t){this.valid=t,this.invalid=!t,this.setValidated(!0)},Flags.prototype.setDirty=function(t){this.dirty=t,this.pristine=!t},Flags.prototype.setTouched=function(t){this.touched=t,this.untouched=!t},Flags.prototype.setPending=function(t){this.pending=t},Flags.prototype.setValidated=function(t){this.validated=t},Flags.prototype.setChanged=function(t){this.changed=t};var Field=function(t){if(void 0===t&&(t={initialValue:null,flags:flags,errors:[],keypath:null}),null==t.keypath)throw new Error("keypath must be provided");this.errorList=t.errors||[],this.keypath=t.keypath,this.initialValue=this.value=t.initialValue,this.flags=t.flags||new Flags,this.validating=!1,this.validatingId=null,this.dependencies=[],null==this.flags&&(this.flags=new Flags)};function ValidationBag(){this.sessionId=0,this.resetting=0,this.fields={},this.activated=!1}function setAsyncMessages(t,e){var i=this;this.resetValidating(t);var n=this.setValidating(t),r=function(){this.resetValidating(t)}.bind(this);return Promise.all(e).then(function(e){return!!i.isValidating(t,n)&&_addMessages(t,e)}).bind(this).then(function(t){return r(),t}).catch(function(t){return r(),Promise.reject(t)}.bind(this))}function addMessages(t,e){var i=!1;return e.forEach(function(e){e&&(this.addError(t,e),i=!0)},this),i}Field.prototype.getFlags=function(){return this.flags},Field.prototype.setFlags=function(t){for(var e in t)null!=this.flags[e]&&(this.flags[e]=t[e])},Field.prototype.reset=function(){this.flags.reset(),this.value=this.initialValue,this.removeErrors(),this.resetValidating()},Field.prototype.removeErrors=function(){this.errorList=[],this.flags.setValid(!0)},Field.prototype.setInitialValue=function(t){this.initialValue=t,this.setValue(this.value)},Field.prototype.setValue=function(t){this.value=t,this.initialValue!==t?(this.flags.setDirty(!0),this.flags.setChanged(!0)):this.flags.setChanged(!1)},Field.prototype.hasError=function(){return this.errorList.length>0},Field.prototype.addError=function(t){this.flags.setValid(!1),this.errorList.push(t)},Field.prototype.firstError=function(){return this.errorList[0]},Field.prototype.errors=function(){return this.errorList},Field.prototype.setValidating=function(t){this.validating=t,this.flags.setPending(t)},Field.prototype.isValidating=function(){return this.validating},Field.prototype.isIdValidating=function(t){return t===this.getValidatingId()},Field.prototype.setValidatingId=function(t){this.validatingId=t},Field.prototype.getValidatingId=function(){return this.validatingId},Field.prototype.resetValidating=function(){this.setValidatingId(null),field.setValidating(!1)},Field.prototype.getDependencies=function(){return this.dependencies},Field.prototype.setDependencies=function(t){void 0===t&&(t=[]),this.dependencies=t},ValidationBag.prototype._setVM=function(t){this._vm=t},ValidationBag.prototype.addField=function(t){var e=new Field(t);return this._vm.$set(this.fields,t.keypath,e),e},ValidationBag.prototype.addError=function(t,e){if(!this.resetting){var i=this.getField(t);i&&i.addError(e)}},ValidationBag.prototype.getField=function(t){if(null==t)throw new Error("keypath cannot be null");return this.fields[t]},ValidationBag.prototype.removeErrors=function(t){if(null==t)this.fields.forEach(function(t){return t.removeErrors()});else{var e=this.getField(t);e&&e.removeErrors()}},ValidationBag.prototype.hasError=function(t){if(null==t)return Object.values(this.fields).some(function(t){return t.hasError()});var e=this.getField(t);return!!e&&e.hasError()},ValidationBag.prototype.firstError=function(t){if(null==t)for(var e in this.fields){var i=this.fields[e].firstError();if(i)return i}var n=this.fields[t];return n?n.firstError():null},ValidationBag.prototype.allErrors=function(t){if(t)return this.fields[t].errors();Object.values().map(function(t){return t.errors()})},ValidationBag.prototype.countErrors=function(t){if(null==t)this.fields.reduce(function(t,e){e.errors().length});else{var e=this.fields[t];if(e)return e.errors().length}},ValidationBag.prototype.setValidating=function(t,e){if(!this.resetting){e=e||ValidationBag.newValidatingId();var i=this.getField(t);if(i){if(i.getValidatingId()===e)throw new Error("Validating id already set: "+e);return i.setValidatingId(e),i.setValidating(!0),e}}},ValidationBag.prototype.resetValidating=function(t){if(t){var e=this.getField(t);e&&e.resetValidating()}else this.fields.forEach(function(t){return t.resetValidating()})},ValidationBag.prototype.isValidating=function(t,e){var i=this.getField(t);return!!i&&(null==e?i.isValidating():i.isIdValidating(e))},ValidationBag.prototype._isFlag=function(t,e){if(t){var i=this.getField(t);return!!i&&i.getFlags()[e]}for(var n in this.fields){var r=this.fields[n].getFlags();if(console.log(n,e,r[e]),r[e])return!0}return!1},ValidationBag.prototype.show=function(t,e){var i=this,n=this.hasError(t);if(!this.getField(t))return!1;if(e){var r=e.filter(function(e){return i._isFlag(t,e)});return n&&r.length>0}if(n&&this.activated)return!0;var a=this.isTouched(t),s=this.isDirty(t);return!!(n&&a&&s)},ValidationBag.prototype.forceShow=function(t){this.setTouched(t,!0),this.setDirty(t,!0)},ValidationBag.prototype.isValid=function(t){return!this._isFlag(t,"invalid")},ValidationBag.prototype.isInvalid=function(t){return this._isFlag(t,"invalid")},ValidationBag.prototype.isPristine=function(t){return!this._isFlag(t,"dirty")},ValidationBag.prototype.isDirty=function(t){return this._isFlag(t,"dirty")},ValidationBag.prototype.isTouched=function(t){return this._isFlag(t,"touched")},ValidationBag.prototype.isUntouched=function(t){return!this._isFlag(t,"touched")},ValidationBag.prototype.isValidated=function(t){return this._isFlag(t,"validated")},ValidationBag.prototype.isChanged=function(t){return this._isFlag(t,"changed")},ValidationBag.prototype.isPending=function(t){return this._isFlag(t,"pending")},ValidationBag.prototype.setFlag=function(t,e,i){if(null==i)throw new Error(e+" accepts true/false as argument");if(!this.resetting){var n=this.getField(t);n&&n.getFlags()[e](i)}},ValidationBag.prototype.setValid=function(t,e){this.setFlag(t,"setValid",e)},ValidationBag.prototype.setDirty=function(t,e){this.setFlag(t,"setDirty",e)},ValidationBag.prototype.setTouched=function(t,e){this.setFlag(t,"setTouched",e)},ValidationBag.prototype.setPending=function(t,e){this.setFlag(t,"setPending",e)},ValidationBag.prototype.setValidated=function(t,e){this.setFlag(t,"setValidated",e)},ValidationBag.prototype.setChanged=function(t,e){this.setFlag(t,"setChanged",e)},ValidationBag.prototype.reset=function(t){if(t){var e=this.getField(t);e&&e.reset()}else this.sessionId++,Object.values(this.fields).forEach(function(t){t.reset()}),this._vm&&(this.resetting++,this._vm.$nextTick(function(){this.resetting--}.bind(this))),this.activated=!1},ValidationBag.prototype.setError=function(t,e){if(!this.resetting){this.removeErrors(t);var i=addMessages.bind(this),n=setAsyncMessages.bind(this),r=isArray$1(e)?e:[e];if(r.filter(function(t){return t&&t.then}).length>0)return n(t,r);var a=i(t,r);return Promise.resolve(a)}},ValidationBag.prototype.checkRule=function(t){if(!this.resetting)return this.setError(t._field,t._messages)};var validatingId=0;ValidationBag.newValidatingId=function(){return(++validatingId).toString()};var templates={error:"Error.",required:"{0} is required.",float:"{0} must be a number.",integer:"{0} must be an integer.",number:"{0} must be a number.",lessThan:"{0} must be less than {1}.",lessThanOrEqualTo:"{0} must be less than or equal to {1}.",greaterThan:"{0} must be greater than {1}.",greaterThanOrEqualTo:"{0} must be greater than or equal to {1}.",between:"{0} must be between {1} and {2}.",size:"{0} size must be {1}.",length:"{0} length must be {1}.",minLength:"{0} must have at least {1} characters.",maxLength:"{0} must have up to {1} characters.",lengthBetween:"{0} length must between {1} and {2}.",in:"{0} must be either {1}.",notIn:"{0} must not be {1}.",match:"{0} does not match {2}.",regex:"{0} has invalid format.",digit:"{0} must only contain numbers.",email:"{0} is not a valid email.",url:"{0} is not a valid url."},ValidationContext=function(t){t=t||{},this.value=void 0===t.value?void 0:t.value,this.path=t.path||"",this.parts=t.parts||[],this.prop=t.prop||"",this.pathToParent=getPathToParent(this.parts)||""};function getPathToParent(t){return t.slice(0,t.length-1).join(".")}function Rule(t){this._field="",this._ctx=new ValidationContext,this._messages=[],t?(this.templates={},Object.keys(t).forEach(function(t){this.templates[t]=templates[t]}.bind(this)),Object.keys(t).forEach(function(e){this.templates[e]=t[e]}.bind(this))):this.templates=templates}function argsToArray(t,e,i,n){var r=Array.prototype.slice.call(n);return r.unshift(t,e,i),r}Rule.prototype.field=function(t){return this._field=t,this},Rule.prototype.prop=function(t){return this._ctx.prop=t,this},Rule.prototype.context=function(t){var e=0==this._ctx.prop.length?t.prop:this._ctx.prop;return this._ctx=Object.assign(this._ctx,t),this._ctx.prop=e,this},Rule.prototype.custom=function(t,e){var i=e?t.call(e):t();if(i){if(i.then){var n=this;i=Promise.resolve(i).then(function(t){return t}).catch(function(t){return n.templates.error})}this._messages.push(i)}return this},Rule.prototype._checkValue=function(){return this._ctx.value},Rule.prototype.required=function(t){if(isEmpty(this._checkValue())){var e=argsToArray(t,this.templates.required,this._ctx,arguments);this.addMessage.apply(this,e)}return this},Rule.prototype.float=function(t){var e=this._checkValue();if(!isEmpty(e)&&!/^([-+])?([0-9]+(\.[0-9]+)?|Infinity)$/.test(e)){var i=argsToArray(t,this.templates.float,this._ctx,arguments);this.addMessage.apply(this,i)}return this},Rule.prototype.integer=function(t){var e=this._checkValue();if(!isEmpty(e)&&!/^([-+])?([0-9]+|Infinity)$/.test(e)){var i=argsToArray(t,this.templates.integer,this._ctx,arguments);this.addMessage.apply(this,i)}return this},Rule.prototype.rangeCheck=function(t,e,i,n){var r=this._checkValue();if(!isEmpty(r)){var a=parseFloat(r);if(isNaN(a)){var s=argsToArray(t,this.templates.number,this._ctx,i);this.addMessage.apply(this,s)}else if(n(a)){var o=argsToArray(t,e,this._ctx,i);this.addMessage.apply(this,o)}}return this},Rule.prototype.lessThan=function(t,e){return this.rangeCheck(e,this.templates.lessThan,arguments,function(e){return e>=t})},Rule.prototype.lessThanOrEqualTo=function(t,e){return this.rangeCheck(e,this.templates.lessThanOrEqualTo,arguments,function(e){return e>t})},Rule.prototype.greaterThan=function(t,e){return this.rangeCheck(e,this.templates.greaterThan,arguments,function(e){return e<=t})},Rule.prototype.greaterThanOrEqualTo=function(t,e){return this.rangeCheck(e,this.templates.greaterThanOrEqualTo,arguments,function(e){return e<t})},Rule.prototype.between=function(t,e,i){return this.rangeCheck(i,this.templates.between,arguments,function(i){return i<t||i>e})},Rule.prototype.size=function(t,e){var i=this._checkValue();if(!isEmpty(i)&&isArray$1(i)&&i.length!==t){var n=argsToArray(e,this.templates.size,this._ctx,arguments);this.addMessage.apply(this,n)}return this},Rule.prototype.length=function(t,e){var i=this._checkValue();if(!isEmpty(i)&&String(i).length!==t){var n=argsToArray(e,this.templates.length,this._ctx,arguments);this.addMessage.apply(this,n)}return this},Rule.prototype.minLength=function(t,e){var i=this._checkValue();if(!isEmpty(i)&&String(i).length<t){var n=argsToArray(e,this.templates.minLength,this._ctx,arguments);this.addMessage.apply(this,n)}return this},Rule.prototype.maxLength=function(t,e){var i=this._checkValue();if(!isEmpty(i)&&String(i).length>t){var n=argsToArray(e,this.templates.maxLength,this._ctx,arguments);this.addMessage.apply(this,n)}return this},Rule.prototype.lengthBetween=function(t,e,i){var n=this._checkValue();if(!isEmpty(n)){var r=String(n);if(r.length<t||r.length>e){var a=argsToArray(i,this.templates.lengthBetween,this._ctx,arguments);this.addMessage.apply(this,a)}}return this},Rule.prototype.inCheck=function(t,e,i,n,r,a){var s=this._checkValue();if(!Array.isArray(t))throw new Error("validator."+i+"() requires an array of options");if(a(s)){t=optionCombiner(t);var o=Array.prototype.slice.call(r,2),l=[e,n,this._ctx,t].concat(o);this.addMessage.apply(this,l)}return this},Rule.prototype.in=function(t,e){return this.inCheck(t,e,"in",this.templates.in,arguments,function(e){return!isEmpty(e)&&t.indexOf(e)<0})},Rule.prototype.notIn=function(t,e){return this.inCheck(t,e,"in",this.templates.notIn,arguments,function(e){return!isEmpty(e)&&t.indexOf(e)>=0})},Rule.prototype.match=function(t,e,i){var n=this._checkValue();if(!isEmpty(n)&&n!==t){var r=argsToArray(i,this.templates.match,this._ctx,arguments);this.addMessage.apply(this,r)}return this},Rule.prototype.regex=function(t,e,i){var n=this._checkValue();if(!isEmpty(n)&&(isString(t)&&(t=new RegExp(t)),!t.test(n))){var r=argsToArray(e,i=i||this.templates.regex,this._ctx,arguments);this.addMessage.apply(this,r)}return this},Rule.prototype.digit=function(t){return this.regex(/^\d*$/,t,this.templates.digit)},Rule.prototype.email=function(t){return this.regex(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,t,this.templates.email)},Rule.prototype.url=function(t){return this.regex(/(http|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])?/,t,this.templates.url)},Rule.prototype.hasImmediateError=function(){for(var t=0;t<this._messages.length;t++)if(this._messages[t]&&!this._messages[t].then)return!0;return!1},Rule.prototype.addMessage=function(t,e,i){if(t)this._messages.push(t);else{var n=Array.prototype.slice.call(arguments,2);isFunction(e)?t=e.apply(this,n):(n.unshift(e),t=this.formatTemplate.apply(this,n)),this._messages.push(t)}},Rule.prototype.formatTemplate=function(t,e){return formatMessage.apply(this,arguments)};var Validator=newValidator();function newValidator(t){t=t||{};var e={};return Object.keys(Rule.prototype).forEach(function(i){e[i]=function(){var e=new Rule(t.templates);return e[i].apply(e,arguments)}}),e.isEmpty=isEmpty,e.format=format,e}Validator.create=function(t){return newValidator(t)};var mixinUtils={setupDependencies:function(t){var e=this,i=t.$options.avv.deps;i&&Object.keys(i).forEach(function(n){var r=i[n];r&&e.addDependency(t,r)})},addDependency:function(t,e){var i=this,n=e.keypaths;n&&n.forEach(function(r){var a=n.filter(function(t){return t!==r}),s=function(){return t.$validate(a)},o=s;e.debounce&&(o=i.debounce.bind(t)(r,e.debounce,s));var l=t.$watch(r,o);t.$options.validatorsUnwatchCallbacks.push(l)})},debounce:function(t,e,i){var n=function(){return n.sessionId!==this.validation.sessionId?Promise.resolve(!1):i.apply(this,arguments)}.bind(this),r=debounce(n,parseInt(e));return function(){this.validation.setValid(t,!1),n.sessionId=this.validation.sessionId,r.apply(this,arguments)}.bind(this)},cache:function(t,e){return function(){var i=t.cache;i||(i=[],t.cache=i);var n=Array.prototype.slice.call(arguments),r=findInCache(i,n);if(!isUndefined(r))return r;var a=t.apply(this,n);return isUndefined(a)?void 0:a.then?a.then(function(t){isUndefined(t)||("all"!==e&&i.splice(0,i.length),i.push({args:n,result:t}))}):("all"!==e&&i.splice(0,i.length),i.push({args:n,result:a}),a)}},findInCache:function(t,e){var i=t.filter(function(t){return isEqual(e,t.eventData)});if(!isEmpty(i))return i[0].result}},modes={INTERACTIVE:"INTERACTIVE",MANUAL:"MANUAL",CONSERVATIVE:"CONSERVATIVE"},avvConfig={mode:modes.INTERACTIVE,getMode:function(){return this.mode},setMode:function(t){if(null==modes[t])throw new Error("Invalid mode: "+t);this.mode=t}},mixin={Promise:null,beforeMount:function(){this.$validation=this.validation,this.validation&&this.validation._setVM(this),this.$setValidators(this.$options.avv)},beforeDestroy:function(){unwatch(this.$options.validatorsUnwatchCallbacks)},data:function(){var t=this.$options.avv;return t&&t.validators?{validation:new ValidationBag}:{}},methods:{$setValidators:function(t){unwatch(this.$options.validatorsUnwatchCallbacks);this.$options.validateMethods={};this.$options.validatorsUnwatchCallbacks=[],t&&t.validators&&(Object.keys(t.validators).forEach(function(e){var i=t.validators[e];this.$addValidator(e,i)},this),mixinUtils.setupDependencies(this))},$addValidator:function(t,e){var i=generateGetter(this,t);this.validation.addField({keypath:t,initialValue:i()});var n={};if(isFunction(e)||(n=omit(e,"validator"),e=e.validator),n.cache){var r="last"===n.cache?"last":"all";e=mixinUtils.cache(e,r)}var a=createValidateMethod(e,t,i).bind(this);this.$options.validateMethods[t]=a;var s=a;if(n.debounce&&(s=mixinUtils.debounce.bind(this)(t,n.debounce,a)),avvConfig.getMode()!==modes.MANUAL){var o=watchProperty(this,t,s);this.$options.validatorsUnwatchCallbacks.push(o)}},$addDependency:function(t){mixinUtils.addDependency(this,t)},$getValidator:function(t){var e=this.$options.avv;if(e&&e.validators)return e.validators[t]},$validate:function(t){if(this.validation._validatePromise)return this.validation._validatePromise;var e=this.$options.validateMethods;if(isUndefined(t)?(this.validation.activated=!0,e=Object.keys(e).map(function(t){return e[t]})):(t=isArray$1(t)?t:[t],e=t.filter(function(t){return null!=e[t]}).map(function(t){return e[t]})),isEmpty(e))return Promise.resolve(!0);var i=function(){this.validation._validatePromise=null}.bind(this),n=e.map(function(t){return t()});return this.validation._validatePromise=Promise.all(n).then(function(t){return i(),t.filter(function(t){return!!t}).length<=0}.bind(this)).catch(function(t){throw i(),t}),this.validation._validatePromise}}};function unwatch(t){t&&t.forEach(function(t){t()})}function generateGetter(t,e){var i=e.split(".");return function(){for(var e=t,n=0;n<i.length&&(!isNull(e)&&!isUndefined(e));n++)e=e[i[n]];return e}}function watchProperty(t,e,i){return t.$watch(e,function(n,r){var a=t.validation.getField(e);a&&a.setValue(n),i.call()})}function createValidateMethod(t,e,i){var n=splitKeypath(e),r=new ValidationContext(n);return function(){if(avvConfig.getMode()===modes.CONSERVATIVE&&!this.validation.activated)return Promise.resolve(!1);r.value=i();var n=t.apply(this,[r]);return n?(n._field||n.field(e),this.validation.checkRule(n)):(this.validation.setError(e),Promise.resolve(!1))}}var depsByKeypath,utils={remove:function(t,e){var i=t.indexOf(e);-1!==i&&t.splice(i,1)}},EventManager=function(){this.eventData=new Map};EventManager.prototype.addEventListeners=function(t,e,i,n){var r=this;e.forEach(function(e){t.addEventListener(e,i,n);var a=r.eventData.get(t);null==a&&(a=a||[],r.eventData.set(t,a)),a.push({el:t,event:e,listener:i})})},EventManager.prototype.removeEventListeners=function(t,e){var i=this;console.log("before remove",this.eventData.size);var n=this.eventData.get(t);(n=n?n.slice(0):[]).forEach(function(t){i._removeEventListener(t,e)})},EventManager.prototype._removeEventListener=function(t,e){e?e.includes(t.event)&&this._removeListenerAndData(t):this._removeListenerAndData(t),console.log("after remove",this.eventData.size)},EventManager.prototype._removeListenerAndData=function(t){t.el.removeEventListener(t.event,t.listener);var e=this.eventData.get(t.el);utils.remove(e,t),0==e.length&&this.eventData.delete(t.el)},EventManager.prototype.getTouchEventNames=function(t){var e=t.nodeName.toLowerCase();return"input"===e||"textarea"===e||"select"===e||"checkbox"===e||"radio"===e||"datalist"===e?["blur","change"]:[]},EventManager.prototype.findVModelExpr=function(t,e){if(null==t)return null;var i=null;if(e&&(i=e.value?e.value.expr:e.expression),i)return i;if(t.data.model)return t.data.model.expression;if(t.data.directives){var n=t.data.directives.find(function(t){return"model"===t.name});if(n)return n.expression}return null};var dependencyService={_addDependencies:function(t){var e,i=this;if(depsByKeypath)return depsByKeypath;depsByKeypath={};var n=t.$options.avv;return n&&n.deps&&(e=n.deps),e&&Object.keys(e).forEach(function(t){var n=e[t];n&&i.addDependency(n)}),depsByKeypath},addDependency:function(t){var e=fromEntries(t.keypaths);Object.keys(e).forEach(function(t){var i=depsByKeypath[t];i||(i=depsByKeypath[t]={});var n=omit(e,t);Object.assign(i,n)})}},eventManager=new EventManager,ValidateDirective={inserted:function(t,e,i){var n=i.context;if(null==n.validation)throw new Error("Validator hasn't been setup for this view.");t=resolveEl(t,e);var r=eventManager.getTouchEventNames(t),a=eventManager.findVModelExpr(i,e);if(null==a)throw new Error("you must specify the path to your model -> v-validate('person.name')");setupDependencies(a,n),showOnError(e)?n.validation.setTouched(a,!0):eventManager.addEventListeners(t,r,getTouchListener(t,n,a),{once:!0})},unbind:function(t,e,i){t=resolveEl(t,e);var n=eventManager.getTouchEventNames(t);eventManager.removeEventListeners(t,n)}};function setupDependencies(t,e){var i=e.validation.getField(t);if(i){var n=dependencyService._addDependencies(e);i.setDependencies(n[t])}}function resolveEl(t,e){if(e.value&&e.value.el){var i=e.value.el,n=document.querySelector(i);n?t=n:console.error("no element found for v-validate.el: "+i)}return t}function showOnError(t){return!(!t.value||!t.value.showOnError)}function getTouchListener(t,e,i){return function(n){var r=eventManager.getTouchEventNames(t);if(r.includes(n.type.toLowerCase())){e.validation.setTouched(i,!0);var a=e.validation.getField(i);if(a){var s=a.getDependencies();Object.keys(s).forEach(function(t){e.validation.forceShow(t)})}else console.warn("no validation field found for v-model/expr: '"+i+"'. Use v-validate=\"{expr: 'some.keypath'}\" to specify a valid keypath");eventManager.removeEventListeners(t,r)}console.log(n.type)}}var plugin={install:function(t,e){t.mixin(mixin),t.directive("validate",ValidateDirective),e&&(e.templates&&extendTemplates(e.templates),e.mode&&avvConfig.setMode(e.mode),e.Promise&&(mixin.Promise=e.Promise))},extendTemplates:function(t){Object.keys(t).forEach(function(e){templates[e]=t[e]})}},extendTemplates=plugin.extendTemplates;exports.Rule=Rule,exports.ValidationBag=ValidationBag,exports.Validator=Validator,exports.default=plugin,exports.extendTemplates=extendTemplates;
